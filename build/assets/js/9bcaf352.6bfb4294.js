"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[14646],{7574:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>i});var o=s(74848),t=s(28453);const r={},a="Spec.json update",d={id:"about/specs/hard-forks/spec.json-update",title:"Spec.json update",description:"Check the latest hard fork and update your node",source:"@site/docs/about/specs/hard-forks/spec.json-update.md",sourceDirName:"about/specs/hard-forks",slug:"/about/specs/hard-forks/spec.json-update",permalink:"/about/specs/hard-forks/spec.json-update",draft:!1,unlisted:!1,editUrl:"https://github.com/gnosischain/documentation/tree/main/docs/about/specs/hard-forks/spec.json-update.md",tags:[],version:"current",lastUpdatedBy:"Vanshika",lastUpdatedAt:1708167281,formattedLastUpdatedAt:"Feb 17, 2024",frontMatter:{},sidebar:"about",previous:{title:"#1604400 - 2019-01-11",permalink:"/about/specs/hard-forks/1604400"},next:{title:"EIP-1559",permalink:"/about/specs/hard-forks/eip-1559"}},c={},i=[];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"specjson-update",children:"Spec.json update"}),"\n",(0,o.jsx)(n.admonition,{title:"Archived page",type:"caution",children:(0,o.jsx)(n.p,{children:"Check the latest hard fork and update your node"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["This guide assumes that you're running this playbook from the same machine you used to make initial deployment of your node. You should already have ",(0,o.jsx)(n.code,{children:"python"})," and ",(0,o.jsx)(n.code,{children:"ansible"})," installed, and you have the correct ssh keypair to root-access the node."]})}),"\n",(0,o.jsxs)(n.p,{children:["1) If you already have a cloned version of the poa-devops repository (",(0,o.jsx)(n.a,{href:"https://github.com/poanetwork/poa-devops.git",children:"https://github.com/poanetwork/poa-devops.git"}),"), pull the latest changes:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd poa-devops\ngit pull origin master\n"})}),"\n",(0,o.jsx)(n.p,{children:"otherwise, clone this repository:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/poanetwork/poa-devops.git\ncd poa-devops\n"})}),"\n",(0,o.jsxs)(n.p,{children:["1) create ",(0,o.jsx)(n.code,{children:"group_vars/all"})," file:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cp group_vars/hf-spec-change.example group_vars/all\n"})}),"\n",(0,o.jsx)(n.p,{children:"and set the following variables:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"poa_role"})," - node's role (one of ",(0,o.jsx)(n.code,{children:"bootnode"}),", ",(0,o.jsx)(n.code,{children:"validator"}),", ",(0,o.jsx)(n.code,{children:"moc"}),", ",(0,o.jsx)(n.code,{children:"explorer"}),", ",(0,o.jsx)(n.code,{children:"netstat"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:'MAIN_REPO_FETCH: "poanetwork"'}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:'GENESIS_BRANCH: "dai"'})," )"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["2) Create/edit ",(0,o.jsx)(n.code,{children:"hosts"})," file:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'echo "" > hosts\n'})}),"\n",(0,o.jsx)(n.p,{children:"and put your node's ip address (assuming it's 192.0.2.1) as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"[hf-spec-change]\n192.0.2.1\n"})}),"\n",(0,o.jsxs)(n.p,{children:["make sure you don't have other tags (",(0,o.jsx)(n.code,{children:"[...]"}),") in hosts file, ",(0,o.jsx)(n.strong,{children:"and double check you are using your DAI node's IP address"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"For those who host multiple nodes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"if all your nodes are of the same role (e.g. all bootnodes), you can run this playbook on all of them by listing their ips, e.g."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"[hf-spec-change]\n192.0.2.1\n192.0.2.2\n192.0.2.3\n192.0.2.4\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["if you host nodes of different types you can set ",(0,o.jsx)(n.code,{children:"poa_role"})," individually against the corresponding ip address like so:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"[hf-spec-change]\n192.0.2.1 poa_role=explorer\n192.0.2.2\n192.0.2.3 poa_role=moc\n192.0.2.4\n"})}),"\n",(0,o.jsxs)(n.p,{children:["on lines where you omitted explicit ",(0,o.jsx)(n.code,{children:"poa_role"}),", the value from ",(0,o.jsx)(n.code,{children:"group_vars/all"})," is used."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"3) Run the playbook:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ansible-playbook -i hosts site.yml\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"I"}),"f you get a ssh connection error, try to add ",(0,o.jsx)(n.code,{children:"-e 'ansible_ssh_user=ubuntu'"})," to the command line above, substituting ",(0,o.jsx)(n.code,{children:"ubuntu"})," with correct ssh username, which is usually either ",(0,o.jsx)(n.code,{children:"ubuntu"})," or ",(0,o.jsx)(n.code,{children:"root"})," or ",(0,o.jsx)(n.code,{children:"poa"})," or ",(0,o.jsx)(n.code,{children:"centos"})," depending on your setup"]})}),"\n",(0,o.jsxs)(n.p,{children:["4) Verify that your node is active in netstat (",(0,o.jsx)(n.a,{href:"https://dai-netstat.poa.network/",children:"https://dai-netstat.poa.network/"}),")"]}),"\n",(0,o.jsx)(n.p,{children:"5) connect to the node"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ssh root@192.0.2.1\n"})}),"\n",(0,o.jsx)(n.p,{children:"switch to the home folder of corresponding role:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# substitute validator with your node's role (bootnode, moc, ...)\ncd /home/validator\n"})}),"\n",(0,o.jsxs)(n.p,{children:["and check the update time of ",(0,o.jsx)(n.code,{children:"spec.json"})," (should be about the time you started the playbook)"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ls -lh\n# a long list should appear here, look for spec.json in the rightmost column and check the date and time on the same row\n"})}),"\n",(0,o.jsx)(n.p,{children:"also check that backup was created:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"ls -lh spec-hfs/\n# look for a file named similar to spec-hf-20180108-174649.json Numbers represent date and time in UTC when the playbook was started\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>d});var o=s(96540);const t={},r=o.createContext(t);function a(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);