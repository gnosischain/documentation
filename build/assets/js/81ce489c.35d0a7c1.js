"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[62934],{40089:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var a=t(74848),i=t(28453);const r={title:"Validator Withdrawals"},s="What is Validator Withdrawal?",o={id:"node/management/withdrawals",title:"Validator Withdrawals",description:"Gnosis Chain underwent Shanghai/Capella Hardfork successfully on August 1, 2023 at 11:34.20 UTC, slot 10379264, epoch 648704.",source:"@site/docs/node/management/withdrawals.md",sourceDirName:"node/management",slug:"/node/management/withdrawals",permalink:"/node/management/withdrawals",draft:!1,unlisted:!1,editUrl:"https://github.com/gnosischain/documentation/tree/main/docs/node/management/withdrawals.md",tags:[],version:"current",lastUpdatedBy:"Dee",lastUpdatedAt:1705404574,formattedLastUpdatedAt:"Jan 16, 2024",frontMatter:{title:"Validator Withdrawals"},sidebar:"node",previous:{title:"Voluntary Exit",permalink:"/node/management/voluntary-exit"}},d={},l=[{value:"What is the difference between validator withdrawal in Gnosis Chain and Ethereum?",id:"what-is-the-difference-between-validator-withdrawal-in-gnosis-chain-and-ethereum",level:2},{value:"What action should a validator take?",id:"what-action-should-a-validator-take",level:2},{value:"Check Withdrawal Credential",id:"check-withdrawal-credential",level:3},{value:"How to change the withdrawal credential?",id:"how-to-change-the-withdrawal-credential",level:3},{value:"How to receive my withdrawal (full or partial)?",id:"how-to-receive-my-withdrawal-full-or-partial",level:2},{value:"Reference",id:"reference",level:2}];function h(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.admonition,{title:"Validator withdrawal has now been enabled!",type:"info",children:(0,a.jsx)(n.p,{children:"Gnosis Chain underwent Shanghai/Capella Hardfork successfully on August 1, 2023 at 11:34.20 UTC, slot 10379264, epoch 648704."})}),"\n",(0,a.jsx)(n.h1,{id:"what-is-validator-withdrawal",children:"What is Validator Withdrawal?"}),"\n",(0,a.jsxs)(n.p,{children:["Validator withdrawal allows a validator's account balance get withdrawn from Beacon Chain to Execution Layer, in the form of GNO. The GNO will be accrued on validator's withdrawal address on the Execution Layer, which is set using ",(0,a.jsx)(n.code,{children:"eth1_withdrawal_address"})," option during validator key generation."]}),"\n",(0,a.jsxs)(n.p,{children:["There are 2 types of withdrawals: Partial Withdrawal and Full Withdrawal.",(0,a.jsx)(n.br,{}),"\n",(0,a.jsx)(n.strong,{children:"Partial Withdrawal"}),": Any balance in excess of 1 GNO from the account balance get withdrawn back to withdrawal address.",(0,a.jsx)(n.br,{}),"\n",(0,a.jsx)(n.strong,{children:"Full Withdrawal"}),": All the balance from validator's account get withdrawn back to withdrawal address. This has to be initiated by validator, signing ",(0,a.jsx)(n.a,{href:"/node/management/voluntary-exit",children:"voluntary_exit"})," message and broadcasting it to the network. It is irreversible."]}),"\n",(0,a.jsx)(n.h2,{id:"what-is-the-difference-between-validator-withdrawal-in-gnosis-chain-and-ethereum",children:"What is the difference between validator withdrawal in Gnosis Chain and Ethereum?"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(32789).A+"",width:"1920",height:"1200"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"For users: it is the same!"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Technically:"}),"\nWithdrawals are handled by a smart contract on Gnosis Chain"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"specifically implemented for Gnosis in execution layer clients"}),"\n",(0,a.jsx)(n.li,{children:"same contract as the deposit one"}),"\n",(0,a.jsx)(n.li,{children:"pays out in GNO"}),"\n",(0,a.jsxs)(n.li,{children:["If there's no GNO left in the contract, withdrawals are retried whenever it's topped up","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The failed withdrawal queue is cleared at a constant rate per slot (4-16/slot, TBD), in addition to new withdrawals."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Reference"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/gnosischain/concepts/specs/blob/master/execution/withdrawals.md",children:"Gnosis Chain Withdrawals spec"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/gnosischain/deposit-contract/blob/master/contracts/SBCDepositContract.sol",children:"Withdrawal Contract"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"what-action-should-a-validator-take",children:"What action should a validator take?"}),"\n",(0,a.jsx)(n.h3,{id:"check-withdrawal-credential",children:"Check Withdrawal Credential"}),"\n",(0,a.jsxs)(n.p,{children:["For any type of withdrawals, a validator need to have ",(0,a.jsx)(n.code,{children:"0x01"})," withdrawal credential. You\u2019re fine if you used ",(0,a.jsx)(n.code,{children:"--eth1_withdrawal_address"})," to create your validator keys. If not, tooling will be made available."]}),"\n",(0,a.jsx)(n.p,{children:"There are 2 ways to check withdrawal credential of a validator:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Search on ",(0,a.jsx)(n.a,{href:"https://gnosischa.in/",children:"https://gnosischa.in/"})]}),"\n",(0,a.jsxs)(n.li,{children:["Search on deposit",(0,a.jsx)(n.em,{children:"m"}),"*.json file of your validator."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(4447).A+"",width:"1920",height:"1200"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(55414).A+"",width:"1920",height:"1200"})}),"\n",(0,a.jsx)(n.h3,{id:"how-to-change-the-withdrawal-credential",children:"How to change the withdrawal credential?"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Generate BLStoExecution file using ",(0,a.jsx)(n.a,{href:"https://notes.ethereum.org/@launchpad/withdrawals-guide#BLS-to-execution-with-ethdo",children:"ethdo"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Post the file to the BLStoExecution pool."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r,{children:[(0,a.jsx)("summary",{children:"Step-by-Step tutorial"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Online and Offline process"})}),(0,a.jsx)(n.p,{children:"The online and offline process contains three steps."}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Generate data on the online computer."}),"\n",(0,a.jsx)(n.li,{children:"Generate change-credential.json on an offline computer."}),"\n",(0,a.jsx)(n.li,{children:"Broadcast the credential change operations to the Gnosis Network."}),"\n"]}),(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Prerequisite"})}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["On your online computer, open a terminal and download ",(0,a.jsx)(n.a,{href:"https://github.com/wealdtech/ethdo/releases",children:"ethdo"})," from Github/"]}),"\n"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"wget https://github.com/wealdtech/ethdo/releases/download/<version>/ethdo-<version>-linux-amd64.tar.gz\n"})}),(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Extract ethdo"}),"\n"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"tar -xvf ethdo-<version>-linux-amd64.tar.gz\n"})}),(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsx)(n.li,{children:"Check that ethdo is installed correctly by running"}),"\n"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"./ethdo --help\n"})}),(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["Step 1: Obtain ",(0,a.jsx)(n.code,{children:"offline-preparation.json"})," file"]})}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Connect to your consensus node, and generate ",(0,a.jsx)(n.code,{children:"offline-preparation.json"})]}),"\n"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"./ethdo --connection=http://localhost:<Beacon_Node_Port> validator credentials set --prepare-offline\n"})}),(0,a.jsxs)(n.p,{children:["Check the port of your consensus node, i.e. Lighthouse's default http port is 5052.",(0,a.jsx)(n.br,{}),"\n","An ",(0,a.jsx)(n.code,{children:"offline-preparation.json"})," file will be created."]}),(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:["Copy the ",(0,a.jsx)(n.code,{children:"offline-preparation.json"})," file and ethdo software into a USB."]}),"\n"]}),(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["Step 2: Generate ",(0,a.jsx)(n.code,{children:"change-operations.json"})," file offline"]})}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Use the file you've copied into the USB and run the following command on an offline computer."}),"\n",(0,a.jsxs)(n.p,{children:["Make sure your ",(0,a.jsx)(n.code,{children:"offline-preparation.json"})," is at the same directory where ethdo software is running."]}),"\n"]}),"\n"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'./ethdo validator credentials set --offline --mnemonic="abandon abandon abandon \u2026 art" --withdrawal-address=0x0123\u2026cdef\n'})}),(0,a.jsxs)(n.p,{children:["Replace ",(0,a.jsx)(n.code,{children:"mnemonic"})," with the validator's mnemonic and ",(0,a.jsx)(n.code,{children:"withdrawal-address"})," with a gnosis address for your validator's withdrawal reward.\nA ",(0,a.jsx)(n.code,{children:"change-operations.json"})," file will be created."]}),(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:["Copy the ",(0,a.jsx)(n.code,{children:"change-operations.json"})," file from offline computer to an online computer."]}),"\n"]}),(0,a.jsxs)(n.p,{children:[(0,a.jsxs)(n.strong,{children:["Step 3: Broadcast ",(0,a.jsx)(n.code,{children:"change-operations.json"})," to the network"]}),(0,a.jsx)(n.br,{}),"\n","There are two ways to broadcast the operations:",(0,a.jsx)(n.br,{}),"\n","i. Using UI",(0,a.jsx)(n.br,{}),"\n","ii. Using curl to broadcast the data to your beacon node(advanced)"]}),(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Using UI:"})}),(0,a.jsxs)(n.p,{children:["Upload ",(0,a.jsx)(n.code,{children:"change-operations.json"})," to ",(0,a.jsx)(n.a,{href:"https://gnosischa.in/tools/broadcast",children:"https://gnosischa.in/tools/broadcast"}),", and click 'Submit & Broadcast'.",(0,a.jsx)(n.br,{}),"\n",(0,a.jsx)(n.img,{src:t(51159).A+"",width:"803",height:"882"})]}),(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Using curl"}),(0,a.jsx)(n.br,{}),"\n","This option is only recommended for advanced user. Please use it at your own risk."]}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Open a terminal, navigate to the same directory as you store your ",(0,a.jsx)(n.code,{children:"change-operations.json"}),".\nMake sure to change the beacon_node_port according to your consensus client.",(0,a.jsx)(n.br,{}),"\n","Run the following command."]}),"\n"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'curl -d @change-operations.json -H "Content-Type: application/json"  -X POST http://127.0.0.1:<beacon_node_port>/eth/v1/beacon/pool/bls_to_execution_changes\n'})})]})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:t(96880).A+"",width:"1920",height:"1200"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Reference"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/wealdtech/ethdo/blob/master/docs/changingwithdrawalcredentials.md",children:"Changing withdrawal credential by ethdo"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://notes.ethereum.org/@launchpad/withdrawals-guide#BLS-to-execution-with-ethdo",children:"BLS to execution with ethdo"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://launchpad.ethereum.org/en/btec/#broadcast-message",children:"BLS To Execution Change from Ethereum"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://consensys.github.io/teku/#tag/Beacon/operation/postBlsToExecutionChange",children:"Teku's postBlsToExecutionChange API "})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"how-to-receive-my-withdrawal-full-or-partial",children:"How to receive my withdrawal (full or partial)?"}),"\n",(0,a.jsxs)(n.p,{children:["As we have modified some specs regarding the withdrawals to enable withdrawing GNO instead of the native gas token xDai, unlike Ethereum, partial and full withdrawals do not happen automatically.",(0,a.jsx)(n.br,{}),"\n","Currently you need to manually claim your withdrawal on the contract : ",(0,a.jsx)(n.a,{href:"https://gnosisscan.io/address/0x0B98057eA310F4d31F2a452B414647007d1645d9#writeProxyContract",children:"https://gnosisscan.io/address/0x0B98057eA310F4d31F2a452B414647007d1645d9#writeProxyContract"}),"."]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["If you want to perform full withdrawal, don't forget to initiate ",(0,a.jsx)(n.a,{href:"/node/management/voluntary-exit",children:"voluntary exit"})," before calling ",(0,a.jsx)(n.code,{children:"claimWithdrawal"}),"."]})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Connect your wallet to Gnosisscan (it can be any wallet, doesn't have to be your validator address, anyone can trigger a withdrawal claim) and then enter your validator recipient(withdrawal) address(s) in ",(0,a.jsx)(n.a,{href:"https://gnosisscan.io/address/0x0b98057ea310f4d31f2a452b414647007d1645d9#writeProxyContract#F3",children:(0,a.jsx)(n.code,{children:"claimWithdrawal"})})," or ",(0,a.jsx)(n.a,{href:"https://gnosisscan.io/address/0x0b98057ea310f4d31f2a452b414647007d1645d9#writeProxyContract#F4",children:(0,a.jsx)(n.code,{children:"claimWithdrawals"})})]}),"\n",(0,a.jsx)(n.li,{children:'Click "write" and perform the send tx action on your wallet.'}),"\n",(0,a.jsx)(n.li,{children:"Once the transaction is confirmed, you should see the GNO tokens being transferred to your withdrawal address."}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:['Don\'t use the full length address that you might see on Gnosischa.in, use the recipient address under "Withdrawal" tab.',(0,a.jsx)(n.br,{}),"\n","The ",(0,a.jsx)(n.code,{children:"withdrawal address"})," and the ",(0,a.jsx)(n.code,{children:"recipient address"})," are the same thing."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"validator_recipient_address",src:t(8082).A+"",width:"1746",height:"766"})}),"\n",(0,a.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://www.youtube.com/watch?v=6G7CmTHTor0",children:"Gnosis Validator Meetup #5: Shanghai/Capella Upgrade"})}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},4447:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/CheckWC-9b879585492d17e7b26a57c1d023c98f.png"},32789:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/GCvsETH-0a34e5727dfea9755b7eff0ab9d82bcc.png"},51159:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/changeWithdrawalCredentialBroadast-36c396835dbf6bd4bc6830ff841d67c5.png"},96880:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/conversion_tool-f1acf418825588bb9bc1fda0cd318b21.png"},55414:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/deposit_json-b4139b393734b874d3e56cac075f957d.png"},8082:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/validator_recipient_address-a064f8190ba6c8de9917be3482194e6f.png"},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var a=t(96540);const i={},r=a.createContext(i);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);