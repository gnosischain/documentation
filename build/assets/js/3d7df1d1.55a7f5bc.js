"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[14193],{76500:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>h});var o=i(74848),t=i(28453);const r={title:"Migrating a Validator"},s=void 0,a={id:"node/management/migrating-validator",title:"Migrating a Validator",description:"Migrating validators from one node to another (or from one vm instance to another) requires careful attention to avoid slashing. If you accidentally run the same validator key on 2 instances at the same time, even for a very short time period, you risk being slashed for an Attestation Violation. If this occurs, you will be removed as a validator and your GNO will be frozen and unavailable for withdrawal until after a hard-fork post GC/GBC merge.",source:"@site/docs/node/management/migrating-validator.md",sourceDirName:"node/management",slug:"/node/management/migrating-validator",permalink:"/node/management/migrating-validator",draft:!1,unlisted:!1,editUrl:"https://github.com/gnosischain/documentation/tree/main/docs/node/management/migrating-validator.md",tags:[],version:"current",lastUpdatedBy:"zengzengzenghuy",lastUpdatedAt:1689403611,formattedLastUpdatedAt:"Jul 15, 2023",frontMatter:{title:"Migrating a Validator"},sidebar:"node",previous:{title:"Monitoring your Node(s)",permalink:"/node/management/monitoring-node"},next:{title:"Voluntary Exit",permalink:"/node/management/voluntary-exit"}},l={},h=[{value:"Order of Operations",id:"order-of-operations",level:2},{value:"Lighthouse",id:"lighthouse",level:2},{value:"Export",id:"lighthouse-export",level:3},{value:"Import",id:"lighthouse-import",level:3},{value:"Lodestar",id:"lodestar",level:2},{value:"Export",id:"lodestar-export",level:3},{value:"Import",id:"lodestar-import",level:3},{value:"Nimbus",id:"nimbus",level:2},{value:"Export",id:"nimbus-export",level:3},{value:"Import",id:"nimbus-import",level:3},{value:"Prysm",id:"prysm",level:2},{value:"Export",id:"prysm-export",level:3},{value:"Import",id:"prysm-import",level:3},{value:"Teku",id:"teku",level:2},{value:"Export",id:"teku-export",level:3},{value:"Import",id:"teku-import",level:3},{value:"More Resources",id:"more-resources",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Migrating validators from one node to another (or from one vm instance to another) requires careful attention to avoid slashing. If you accidentally run the same validator key on 2 instances at the same time, even for a very short time period, you risk being slashed for an Attestation Violation. If this occurs, you will be removed as a validator and your GNO will be frozen and unavailable for withdrawal until after a hard-fork post GC/GBC merge."}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Curious about validators who have been slashed? You can find them here: ",(0,o.jsx)(n.a,{href:"https://gnosischa.in//validators/slashings",children:"https://gnosischa.in/validators/slashings"})]})}),"\n",(0,o.jsx)(n.h2,{id:"order-of-operations",children:"Order of Operations"}),"\n",(0,o.jsx)(n.p,{children:"Specific instructions will differ depending on the client you are running. In general, you will want to follow these steps to prevent slashing when performing a migration. You will experience some downtime but it's much better than being slashed!"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Download initial state from original validator."}),"\n",(0,o.jsx)(n.li,{children:"Stop original validator."}),"\n",(0,o.jsxs)(n.li,{children:["Export slashing protection history from original validator. (",(0,o.jsx)(n.a,{href:"https://eips.ethereum.org/EIPS/eip-3076",children:"EIP-3076"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Download and backup original validator accounts (keystores)."}),"\n",(0,o.jsx)(n.li,{children:"Import initial state and slashing protection history from original validator to the new validator."}),"\n",(0,o.jsxs)(n.li,{children:["Remove account data from original validator, make sure it is not running! This is critical to avoid slashing! Some recommendations:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Rename or move keys folder in the original validator to another location."}),"\n",(0,o.jsxs)(n.li,{children:["Stop and remove containers (",(0,o.jsx)(n.code,{children:"docker-compose down"}),") if you are using Docker."]}),"\n",(0,o.jsxs)(n.li,{children:["Remove old images (",(0,o.jsx)(n.code,{children:"docker rmi $(docker images | grep 'gbc-')"})," if you used the Launchpad)."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Start new validator."}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"danger",children:(0,o.jsxs)(n.p,{children:["Best practice to minimize slashing risks is to wait > 1 epoch ",(0,o.jsx)(n.a,{href:"https://gnosischa.in//epochs",children:"(you can check here to see epoch)"})," following any actions taken by the original validator before starting the new (migrated) validator. This will happen naturally if you stop the original validator at the beginning of the process."]})}),"\n",(0,o.jsx)(n.h2,{id:"lighthouse",children:"Lighthouse"}),"\n",(0,o.jsx)(n.h3,{id:"lighthouse-export",children:"Export"}),"\n",(0,o.jsx)(n.p,{children:"Lighthouse supports the slashing protection interchange format. You can export Lighthouse's database for use with another client with this command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"lighthouse account validator slashing-protection export <lighthouse_interchange.json>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"lighthouse-import",children:"Import"}),"\n",(0,o.jsx)(n.p,{children:"With your validator client stopped, you can import a .json interchange file from another client using this command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"lighthouse account validator slashing-protection import <my_interchange.json>\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["For more info, see the ",(0,o.jsx)(n.a,{href:"https://lighthouse-book.sigmaprime.io/slashing-protection.html#import-and-export",children:"Lighthouse Import and Export docs"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"lodestar",children:"Lodestar"}),"\n",(0,o.jsx)(n.h3,{id:"lodestar-export",children:"Export"}),"\n",(0,o.jsx)(n.p,{children:"Export an interchange JSON file for all validators in the slashing protection DB:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"validator slashing-protection export --network gnosis --file interchange.json\n"})}),"\n",(0,o.jsx)(n.h3,{id:"lodestar-import",children:"Import"}),"\n",(0,o.jsx)(n.p,{children:"Import an interchange file to the slashing protection DB:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"validator slashing-protection import --network gnosis --file interchange.json\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["For more info, see the ",(0,o.jsx)(n.a,{href:"https://chainsafe.github.io/lodestar/reference/cli/#validator-slashing-protection",children:"Lodestar Command Line Reference doc"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"nimbus",children:"Nimbus"}),"\n",(0,o.jsx)(n.h3,{id:"nimbus-export",children:"Export"}),"\n",(0,o.jsx)(n.p,{children:"Run the following to export your Nimbus validator's slashing protection history:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"build/nimbus_beacon_node slashingdb export slashing-protection.json\n"})}),"\n",(0,o.jsx)(n.h3,{id:"nimbus-import",children:"Import"}),"\n",(0,o.jsx)(n.p,{children:"To import the slashing protection history run:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"build/nimbus_beacon_node slashingdb import path/to/export_dir/slashing-protection.json\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["For more info, see the Nimbus ",(0,o.jsx)(n.a,{href:"https://nimbus.guide/migration.html",children:"Migration"})," docs."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"prysm",children:"Prysm"}),"\n",(0,o.jsx)(n.h3,{id:"prysm-export",children:"Export"}),"\n",(0,o.jsx)(n.p,{children:"Run the following to export your Prysm validator's slashing protection history:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"prysm.sh validator slashing-protection-history export --datadir=/your/prysm/wallet --slashing-protection-export-dir=/path/to/export_dir\n"})}),"\n",(0,o.jsx)(n.h3,{id:"prysm-import",children:"Import"}),"\n",(0,o.jsx)(n.p,{children:"You can import it as follows using any installation method for your Prysm validator."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"prysm.sh validator slashing-protection-history import --datadir=/path/to/your/validator/db --slashing-protection-json-file=/path/to/desiredimportfile\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["For more info, see the Prysm ",(0,o.jsx)(n.a,{href:"https://docs.prylabs.network/docs/wallet/slashing-protection",children:"Import & export slashing protection history"})," doc."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"teku",children:"Teku"}),"\n",(0,o.jsx)(n.h3,{id:"teku-export",children:"Export"}),"\n",(0,o.jsx)(n.p,{children:"You can export Teku's database with this command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"teku slashing-protection export --data-path=/home/me/me_node --to=/home/slash/slashing-protection.json\n"})}),"\n",(0,o.jsx)(n.h3,{id:"teku-import",children:"Import"}),"\n",(0,o.jsxs)(n.p,{children:["When importing the slashing-protection file, Teku imports the file to the ",(0,o.jsx)(n.code,{children:"<data-path>/validators/slashprotection/"})," directory in the format ",(0,o.jsx)(n.code,{children:"<validator-pubkey>.yml"})," (with no 0x prefix)."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"teku slashing-protection import --data-path=/home/me/me_node --from=/home/slash/slashing-interchange-format.json\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["For more info, see the Teku ",(0,o.jsx)(n.a,{href:"https://docs.teku.consensys.net/en/latest/HowTo/Prevent-Slashing/",children:"Slashing protection"})," docs."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"more-resources",children:"More Resources"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://www.coincashew.com/coins/overview-eth/guide-or-how-to-setup-a-validator-on-eth2-mainnet/part-iii-tips/switching-migrating-consensus-client",children:"Lighthouse, Prysm and other client implementations)"})," from Coin Cashew"]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>a});var o=i(96540);const t={},r=o.createContext(t);function s(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);