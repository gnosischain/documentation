"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[82755],{19523:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var n=a(74848),r=a(28453);const t={},i="Tutorial",o={id:"bridges/hashi/Tutorial",title:"Tutorial",description:"Query block hash from Hashi",source:"@site/docs/bridges/hashi/Tutorial.md",sourceDirName:"bridges/hashi",slug:"/bridges/hashi/Tutorial",permalink:"/bridges/hashi/Tutorial",draft:!1,unlisted:!1,editUrl:"https://github.com/gnosischain/documentation/tree/main/docs/bridges/hashi/Tutorial.md",tags:[],version:"current",lastUpdatedBy:"Vanshika",lastUpdatedAt:1708167281,formattedLastUpdatedAt:"Feb 17, 2024",frontMatter:{}},c={},d=[{value:"Query block hash from Hashi",id:"query-block-hash-from-hashi",level:2},{value:"Report block header",id:"report-block-header",level:2},{value:"Message Dispatching using Yaru and Yaho",id:"message-dispatching-using-yaru-and-yaho",level:2},{value:"Prerequisite",id:"prerequisite",level:3},{value:"Initiate Transaction",id:"initiate-transaction",level:3},{value:"Claim Transaction",id:"claim-transaction",level:3},{value:"Create a new adapter",id:"create-a-new-adapter",level:2},{value:"Header Reporter contract",id:"header-reporter-contract",level:3},{value:"Adapter contract",id:"adapter-contract",level:3}];function h(e){const s={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"tutorial",children:"Tutorial"}),"\n",(0,n.jsx)(s.h2,{id:"query-block-hash-from-hashi",children:"Query block hash from Hashi"}),"\n",(0,n.jsxs)(s.p,{children:["To query a block hash from Hashi, navigate to ",(0,n.jsx)(s.a,{href:"https://gnosisscan.io/address/0x31a8e89d6f98454d38c03eca3dc543f6581d607c#readContract",children:"ShoyuBashi"})," contract on gnosisscan.",(0,n.jsx)(s.br,{}),"\n","Click ",(0,n.jsx)(s.code,{children:"getThresholdHash"})," function."]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{src:a(93104).A+"",width:"1447",height:"817"})}),"\n",(0,n.jsxs)(s.p,{children:["Enter the domain (chain ID, i.e. 5 for Goerli) and id (block number from domain) for the block you want to query.",(0,n.jsx)(s.br,{}),"\n","The result will be the block hash that has passed the threshold from adapters (i.e. 2 out of 4 in Goerli  < > GC). Not every block will be stored by the adapters and reach threshold, if no threshold has been reached, the result will be bytes32(0). You can utilize ",(0,n.jsx)(s.a,{href:"https://hashiadapters-dashboard-tvw47.ondigitalocean.app/",children:"Adapters Dashboard"})," to check which block has been stored."]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{src:a(70356).A+"",width:"1367",height:"336"})}),"\n",(0,n.jsxs)(s.p,{children:["You may double check if the block hash is correct by searching your block hash in ",(0,n.jsx)(s.a,{href:"https://hashiadapters-dashboard-tvw47.ondigitalocean.app/",children:"Adapters Dashboard"}),"."]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.img,{src:a(64317).A+"",width:"979",height:"440"})}),"\n",(0,n.jsx)(s.h2,{id:"report-block-header",children:"Report block header"}),"\n",(0,n.jsx)(s.p,{children:"You may call a block header reporter to report and store the block hash, if the block you are looking for is not yet stored by the adapter."}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Navigate to ",(0,n.jsx)(s.a,{href:"https://goerli.etherscan.io/address/0xedc0b1d3de4496e0d917af42f29cb71eb2982319",children:"AMB Header Reporter"})," or ",(0,n.jsx)(s.a,{href:"https://docs.gnosischain.com/bridges/hashi/",children:"Sygma Header Reporter"})," contract."]}),"\n",(0,n.jsxs)(s.li,{children:["Select ",(0,n.jsx)(s.strong,{children:"Contract"})," and ",(0,n.jsx)(s.strong,{children:"Write Contract"}),"."]}),"\n",(0,n.jsx)(s.li,{children:"Connect your wallet and switch to the correct network."}),"\n",(0,n.jsxs)(s.li,{children:["Click ",(0,n.jsx)(s.strong,{children:"reportHeaders"})," and input blockNumbers (uint256 []), ",(0,n.jsx)(s.a,{href:"https://docs.gnosischain.com/bridges/hashi/#current-deployments",children:"adapters address"})," and gas."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"message-dispatching-using-yaru-and-yaho",children:"Message Dispatching using Yaru and Yaho"}),"\n",(0,n.jsx)(s.p,{children:"With Yaru and Yaho, you can pass arbitrary message across the chain."}),"\n",(0,n.jsx)(s.h3,{id:"prerequisite",children:"Prerequisite"}),"\n",(0,n.jsx)(s.p,{children:"For Goerli->Gnosis Direction:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Deploy ",(0,n.jsx)(s.a,{href:"https://github.com/gnosis/hashi/blob/main/packages/evm/contracts/Yaho.sol",children:"Yaho"})," on Goerli, and ",(0,n.jsx)(s.a,{href:"https://github.com/gnosis/hashi/blob/main/packages/evm/contracts/Yaru.sol",children:"Yaru"})," on Gnosis Chain, with constructor ",(0,n.jsx)(s.code,{children:"_hashi: Hashi address on Gnosis Chain, _yaho: Yaho address on Goerli, _chainId: 5"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["Optional: Deploy ",(0,n.jsx)(s.a,{href:"https://github.com/gnosis/hashi/blob/main/packages/evm/contracts/zodiac/HashiModule.sol",children:"Hashi Module"})," for Safe that will be called by Yaru, i.e. Safe on Gnosis Chain."]}),"\n",(0,n.jsxs)(s.li,{children:["Deploy ",(0,n.jsx)(s.a,{href:"https://github.com/gnosis/hashi/blob/main/packages/evm/contracts/adapters/AMB/AMBMessageRelayer.sol",children:"AMB Message Relay"})," on Goerli, with constructor ",(0,n.jsx)(s.code,{children:"_amb: AMB address on Goerli, _yaho: Yaho address on Goerli"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["Deploy ",(0,n.jsx)(s.a,{href:"https://github.com/gnosis/hashi/blob/main/packages/evm/contracts/adapters/AMB/AMBAdapter.sol",children:"AMB Adapter"})," on Gnosis Chain, with constructor ",(0,n.jsx)(s.code,{children:"_amb: AMB address on Gnosis Chain, _reporter: AMB Message Relay on Goerli, _chainId: bytes32(5) "}),"."]}),"\n"]}),"\n",(0,n.jsx)(s.admonition,{type:"info",children:(0,n.jsxs)(s.p,{children:["The contract address is available at ",(0,n.jsx)(s.a,{href:"/bridges/hashi/Application#message-dispatching-using-yaho-and-yaru",children:"Message Dispatching using Yaho and Yaru"}),".",(0,n.jsx)(s.br,{}),"\n","Check out ",(0,n.jsx)(s.a,{href:"/bridges/hashi/Application#push-flow",children:"Safe on Hashi-Push Flow"})," for more details."]})}),"\n",(0,n.jsx)(s.h3,{id:"initiate-transaction",children:"Initiate Transaction"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"Create function calldata for the contract you want to call on Gnosis Chain."}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"const calldata = contractInterface.encodeFunctionData(function_name, parameters)\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"2",children:["\n",(0,n.jsx)(s.li,{children:"Optional: Create transaction calldata for Hashi Module."}),"\n"]}),"\n",(0,n.jsx)(s.admonition,{type:"info",children:(0,n.jsxs)(s.p,{children:["This step is only needed when ",(0,n.jsx)(s.a,{href:"https://safe.global/",children:"Safe"})," is used."]})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:'const txData = hashi_module_interface.encodeFunctionData("executeTransaction", [\n      ${contract_to_call_on_Gnosis_Chain},\n      0,\n      calldata,\n      0,\n]);\n'})}),"\n",(0,n.jsxs)(s.ol,{start:"3",children:["\n",(0,n.jsx)(s.li,{children:"Create message with format below:\nWith Safe:"}),"\n"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"const message =\n{\n    to: ${Hashi Module address},\n    toChainId: 100 // Gnosis Chain,\n    data: ${tx_data}\n}\n"})}),"\n",(0,n.jsx)(s.p,{children:"Without Safe:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"const message =\n{\n    to: ${Contract address on Gnosis Chain},\n    toChainId: 100 // Gnosis Chain,\n    data: ${calldata}\n}\n"})}),"\n",(0,n.jsxs)(s.ol,{start:"4",children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:["Call ",(0,n.jsx)(s.code,{children:"Yaho.dispatchMessagesToAdapters([message],[AMB_Message_Relay_Address],[AMB_Adapter_Address])"})," using Safe or EOA."]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:["Once the transaction is created, you need to collect ",(0,n.jsx)(s.code,{children:"messsage Id"})," from ",(0,n.jsxs)(s.a,{href:"https://github.com/gnosis/hashi/blob/main/packages/evm/contracts/Yaho.sol#L27",children:[(0,n.jsx)(s.code,{children:"MessageDispatched"})," event"]})," emitted from Yaho."]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"claim-transaction",children:"Claim Transaction"}),"\n",(0,n.jsxs)(s.p,{children:["After the message is relayed to Gnosis Chain by AMB bridge, you can proceed to claim your transaction.\nMake sure that your message is stored by checking if the AMB Adapter contract emits ",(0,n.jsx)(s.code,{children:"HashStored"})," event with the correct ",(0,n.jsx)(s.code,{children:"message Id"}),"."]}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Call ",(0,n.jsx)(s.code,{children:"Yaru.executeMessages([message],[messageId],[Safe_from_Goerli or EOA from Goerli that calls Yaho],[AMB_Adapter_Address on Gnosis Chain])"})]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"create-a-new-adapter",children:"Create a new adapter"}),"\n",(0,n.jsx)(s.p,{children:"Integrating a new adapter into Hashi enhances the security of the overall architecture."}),"\n",(0,n.jsx)(s.p,{children:"There are two contracts need to be created:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsx)(s.li,{children:"Header Reporter contract on source chain"}),"\n",(0,n.jsx)(s.li,{children:"Adapter contract on destination chain"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"header-reporter-contract",children:"Header Reporter contract"}),"\n",(0,n.jsx)(s.p,{children:"Header reporter contract will be called by user or bot to pass block header of certain block(s) from source chain."}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Create a public function called ",(0,n.jsx)(s.code,{children:"reportHeaders"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["In the ",(0,n.jsx)(s.code,{children:"reportHeaders"})," function, define the bridging logic and make sure three requirements are met:",(0,n.jsx)(s.br,{}),"\n","i. Call ",(0,n.jsx)(s.code,{children:"storeBlockHeaders()"})," from HeaderStorage contract",(0,n.jsx)(s.br,{}),"\n","ii. Bridge block headers returned from the above step with encoded data that will call the function to store block headers in adapter contract on destination chain",(0,n.jsx)(s.br,{}),"\n","iii. Emit ",(0,n.jsx)(s.code,{children:"HeaderReported()"})," event."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Example"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"function reportHeaders(uint256[] memory blockNumbers) public {\n    // return block header(s) of block number(s)\n    bytes32[] memory blockHeaders = headerStorage.storeBlockHeaders(blockNumbers)\n    // pass block header to bridge\n    Bridge.passMessage(blockHeaders, storeHashesEncodedData)\n    // emit event for each block header\n    for (uint i = 0; i < blockNumbers.length; i++){\n        emit HeaderReported(address(this),blockNumbers[i],blockHeaders[i])\n    }\n}\n"})}),"\n",(0,n.jsx)(s.h3,{id:"adapter-contract",children:"Adapter contract"}),"\n",(0,n.jsx)(s.p,{children:"Create a new adapter contract for your oracle that can store block headers and fetched by Hashi."}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["Inherit ",(0,n.jsx)(s.code,{children:"OracleAdapter.sol"})," and ",(0,n.jsx)(s.code,{children:"BlockHashOracleAdapter.sol"}),"."]}),"\n",(0,n.jsxs)(s.li,{children:["Create a ",(0,n.jsx)(s.code,{children:"storeHash"})," function that will call ",(0,n.jsx)(s.code,{children:"_storeHash"})," with the following parameter:",(0,n.jsx)(s.br,{}),"\n",(0,n.jsx)(s.code,{children:"domain"}),"(uint256): Identifier for the domain, i.e. chain id.",(0,n.jsx)(s.br,{}),"\n",(0,n.jsx)(s.code,{children:"id"}),"(uint256): Identifier for the ID of the hash, i.e. block number.",(0,n.jsx)(s.br,{}),"\n",(0,n.jsx)(s.code,{children:"hash"}),"(bytes3): block hash(block header).",(0,n.jsx)(s.br,{}),"\n","Calling ",(0,n.jsx)(s.code,{children:"_storeHash"})," willl emit ",(0,n.jsx)(s.code,{children:"Hashstored(id,hash)"})," event."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Example"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"\ncontract Adapter is OracleAdapter, BlockHashOracleAdapter {\n    function storeHashes(uint256[] memory ids, bytes32[] memory hashes)public{\n        for(uint256 i = 0; i < ids.length; i++){\n            _storeHash(sourceChainID, ids[i], hashes[i])\n        }\n    }\n}\n\n"})})]})}function l(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},64317:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/AdaptersDashboardData-b818609db9ae237fb07305f5bd729dfe.png"},70356:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/callgetThresholdHash-b6d6d07d5401fe897b5373db00ccc087.png"},93104:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/getThresholdHash-9a5e963c87c9b17f9fe0898f7744d039.png"},28453:(e,s,a)=>{a.d(s,{R:()=>i,x:()=>o});var n=a(96540);const r={},t=n.createContext(r);function i(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);